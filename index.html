<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>‚ú¶ OMNI-MATRICE | Vision UI & Neuro-Optique</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600&family=Outfit:wght@200;300;400;500;600&family=Space+Mono:wght@400;700&display=swap');

:root {
  --bg: #020005; --tx: #f0e6fc;
  --glass: rgba(20, 10, 35, 0.35);
  --glass-border: rgba(255, 255, 255, 0.1);
  --c1: #9d4edd; --c2: #3a0ca3; --c3: #f72585; --c4: #00f5d4; --gold: #e5b15c;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}

body {
  min-height: 100dvh; background: var(--bg); color: var(--tx);
  font-family: 'Outfit', sans-serif; overflow-x: hidden; padding-bottom: 120px;
  perspective: 1000px; /* Pour l'effet 3D */
}

/* --- SVG NOISE FILTER (Apple Vision Pro Style) --- */
.noise-overlay {
  position: absolute; inset: 0; opacity: 0.4; pointer-events: none; mix-blend-mode: overlay; z-index: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
}

/* --- AURORA BACKGROUND --- */
.aurora-container { position: fixed; inset: 0; z-index: -1; overflow: hidden; pointer-events: none; background: #000; }
.aurora { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.6; mix-blend-mode: screen; animation: float 25s infinite alternate ease-in-out; }
.a1 { top: -10%; left: -10%; width: 60vw; height: 60vw; background: var(--c2); }
.a2 { bottom: -20%; right: -10%; width: 70vw; height: 70vw; background: var(--c1); animation-delay: -5s; }
.a3 { top: 40%; left: 30%; width: 50vw; height: 50vw; background: var(--c3); opacity: 0.3; animation-delay: -10s; }
.a4 { top: 10%; right: 20%; width: 40vw; height: 40vw; background: var(--c4); opacity: 0.2; animation-delay: -15s; }

@keyframes float { 0% { transform: translate(0, 0) scale(1); } 50% { transform: translate(15vw, 10vh) scale(1.2); } 100% { transform: translate(-10vw, 5vh) scale(0.9); } }

/* Th√®mes de M√©ditation */
body.mode-aube .a1 { background: #00f5d4; } body.mode-aube .a2 { background: #fee440; } body.mode-aube .a3 { background: #00bbf9; }
body.mode-soir .a1 { background: #6a040f; } body.mode-soir .a2 { background: #d00000; } body.mode-soir .a3 { background: #370617; }
body.mode-quantum .a1 { background: var(--gold); } body.mode-quantum .a2 { background: #fff; } body.mode-quantum .a3 { background: #ffb703; }
body.mode-pineal .a1 { background: #7209b7; } body.mode-pineal .a2 { background: #4cc9f0; } body.mode-pineal .a3 { background: #f72585; }
body.mode-schumann .a1 { background: #2d6a4f; } body.mode-schumann .a2 { background: #1b4332; } body.mode-schumann .a3 { background: #40916c; }

/* --- VISION UI GLASSMORPHISM --- */
.glass {
  background: var(--glass); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
  border: 1px solid var(--glass-border); border-top: 1px solid rgba(255,255,255,0.25); border-left: 1px solid rgba(255,255,255,0.15);
  border-radius: 28px; box-shadow: 0 30px 60px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.05); 
  padding: 28px; margin-bottom: 25px; position: relative; overflow: hidden;
  transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#APP { position: relative; z-index: 2; max-width: 680px; margin: 0 auto; padding: 20px; }

/* Navigation Flottante */
.tabs {
  position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 420px;
  background: rgba(5, 2, 12, 0.65); backdrop-filter: blur(50px); -webkit-backdrop-filter: blur(50px);
  border: 1px solid rgba(255,255,255,0.1); border-top: 1px solid rgba(255,255,255,0.25);
  border-radius: 100px; padding: 8px; z-index: 999; display: flex; gap: 4px; box-shadow: 0 30px 60px rgba(0,0,0,0.9);
  transition: 0.6s cubic-bezier(0.25, 1, 0.5, 1);
}
.tabs.hidden { opacity: 0; transform: translate(-50%, 120px) scale(0.8); pointer-events: none; }
.tab { flex: 1; font-family: 'Space Mono'; font-size: 0.55rem; letter-spacing: 0.15em; text-transform: uppercase; color: rgba(255,255,255,.5); background: transparent; border: none; border-radius: 100px; padding: 18px 0; cursor: pointer; transition: 0.4s; }
.tab.act { background: rgba(255,255,255,0.12); color: #fff; box-shadow: inset 0 0 15px rgba(255,255,255,0.05); }

.panel { display: none; animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(40px) scale(0.97); }
.panel.show { display: block; }
@keyframes fadeUp { to { opacity: 1; transform: translateY(0) scale(1); } }

/* Typographie */
h1 { font-family: 'Cinzel'; font-size: 2.2rem; font-weight: 600; color: #fff; text-align: center; margin-bottom: 30px; letter-spacing: 0.25em; text-shadow: 0 0 40px rgba(157, 78, 221, 0.8); }
h2 { font-family: 'Cinzel'; font-size: 1.2rem; color: #fff; text-align: center; margin-bottom: 15px; letter-spacing: 0.15em; font-weight: 500;}
h3 { font-family: 'Space Mono'; font-size: 0.6rem; color: var(--c4); text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.25em; text-align: center; }

/* Boutons Magn√©tiques */
.btn { width: 100%; font-family: 'Space Mono'; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.2em; color: #fff; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-top: 1px solid rgba(255,255,255,0.4); border-radius: 20px; padding: 24px; cursor: pointer; transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1); text-transform: uppercase; margin-top: 10px; backdrop-filter: blur(10px); position: relative; overflow: hidden;}
.btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: 0.5s; }
.btn:hover::before { left: 100%; }
.btn:hover { background: rgba(255,255,255,0.15); transform: translateY(-4px) scale(1.02); box-shadow: 0 15px 35px rgba(0,0,0,0.6), 0 0 25px var(--c1); border-color: rgba(255,255,255,0.6); }
.btn-gold { border-color: rgba(229,177,92,0.6); color: var(--gold); }
.btn-gold:hover { box-shadow: 0 15px 35px rgba(0,0,0,0.6), 0 0 30px var(--gold); border-color: var(--gold); }

/* Setup Overlay */
#setupOv { position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,.85); backdrop-filter: blur(50px); display: flex; align-items: center; justify-content: center; padding: 20px; }
.sb-inp { width: 100%; background: rgba(0,0,0,.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 18px; color: #fff; font-family: 'Space Mono'; font-size: 0.85rem; padding: 20px; margin-bottom: 15px; outline: none; transition: 0.3s; text-align:center; box-shadow: inset 0 4px 10px rgba(0,0,0,0.5);}
.sb-inp:focus { border-color: var(--c4); background: rgba(0,0,0,0.7); box-shadow: inset 0 4px 10px rgba(0,0,0,0.5), 0 0 20px rgba(0,245,212,0.3); }
.sb-area { font-family: 'Cormorant Garamond'; font-size: 1.3rem; font-style: italic; resize: none; height: 110px; text-align: center; }

/* Dashboard UI */
.intention-box { background: rgba(229,177,92,0.08); border: 1px solid rgba(229,177,92,0.3); border-radius: 24px; padding: 25px; text-align: center; margin-bottom: 25px; backdrop-filter: blur(15px); }
.intention-txt { font-family: 'Cormorant Garamond'; font-size: 1.6rem; font-style: italic; color: #fff; line-height: 1.3; text-shadow: 0 0 15px rgba(229,177,92,0.4);}

.ritual-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-top: 20px;}
.rc { text-align: center; padding: 24px 12px; border-radius: 24px; cursor: pointer; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 1px solid rgba(255,255,255,0.08); border-top: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.03); display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(15px); position: relative; overflow: hidden;}
.rc::after { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.1), transparent); opacity: 0; transition: 0.5s; }
.rc:hover::after { opacity: 1; }
.rc:hover { transform: translateY(-8px) scale(1.03); background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.3); box-shadow: 0 20px 40px rgba(0,0,0,0.8), 0 10px 20px rgba(0,0,0,0.4); }
.rc-ico { font-size: 2.6rem; margin-bottom: 12px; filter: drop-shadow(0 5px 15px rgba(255,255,255,0.3)); z-index: 2; position: relative;}
.rc-title { font-family: 'Cinzel'; font-size: 0.9rem; color: #fff; margin-bottom: 8px; letter-spacing: 0.05em; font-weight: 600; z-index: 2; position: relative;}
.rc-sub { font-family: 'Space Mono'; font-size: 0.45rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.15em; z-index: 2; position: relative; }
.rc-full { grid-column: span 2; padding: 30px; border-color: rgba(76, 201, 240, 0.4); background: rgba(76, 201, 240, 0.08); }

/* --- NEURO-OPTIQUE : FLUX OPTIQUE (Aube) --- */
#opticFlowContainer { position: absolute; inset: 0; overflow: hidden; display: none; justify-content: center; align-items: center; z-index: 0; pointer-events: none; }
.optic-ring { position: absolute; border: 2px solid rgba(0, 245, 212, 0.6); border-radius: 50%; box-shadow: 0 0 30px rgba(0, 245, 212, 0.4), inset 0 0 20px rgba(0, 245, 212, 0.2); animation: expandOut 2.5s infinite cubic-bezier(0.2, 0, 1, 1); opacity: 0; }
.optic-ring:nth-child(1) { animation-delay: 0s; } .optic-ring:nth-child(2) { animation-delay: 0.5s; }
.optic-ring:nth-child(3) { animation-delay: 1.0s; } .optic-ring:nth-child(4) { animation-delay: 1.5s; }
.optic-ring:nth-child(5) { animation-delay: 2.0s; }
@keyframes expandOut { 0% { width: 0; height: 0; opacity: 1; border-width: 1px; } 80% { opacity: 0.8; } 100% { width: 150vw; height: 150vw; opacity: 0; border-width: 15px; } }

/* --- VISUELS M√âDITATION CYMATIQUE --- */
.med-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 55vh; position: relative; z-index: 2;}

.cymatic-core {
  width: 220px; height: 220px; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.4);
  box-shadow: 0 0 60px rgba(255,255,255,0.1), inset 0 0 40px rgba(255,255,255,0.15);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  transition: all 1s ease-in-out; text-align: center; position: relative; z-index: 5;
  backdrop-filter: blur(10px);
  animation: morph 8s ease-in-out infinite alternate;
}
.cymatic-core.inhale { transform: scale(1.6); box-shadow: 0 0 120px rgba(255,255,255,0.4), inset 0 0 60px rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.8); }
.cymatic-core.hold { transform: scale(1.6); box-shadow: 0 0 150px var(--gold); border-color: var(--gold); border-radius: 50%; animation-play-state: paused; background: radial-gradient(circle at 50% 50%, rgba(229,177,92,0.4), transparent);}
.cymatic-core.exhale { transform: scale(0.85); box-shadow: 0 0 20px rgba(255,255,255,0.05); opacity: 0.6;}

@keyframes morph {
  0% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
  34% { border-radius: 70% 30% 50% 50% / 30% 30% 70% 70%; }
  67% { border-radius: 100% 60% 60% 100% / 100% 100% 60% 60%; }
  100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
}

.med-text { font-family: 'Cinzel'; font-size: 1.3rem; letter-spacing: 0.2em; font-weight: 700; text-shadow: 0 4px 15px rgba(0,0,0,0.8); }
.med-sub { font-family: 'Space Mono'; font-size: 0.55rem; letter-spacing: 0.25em; opacity: 0.8; margin-top: 8px; text-shadow: 0 2px 5px rgba(0,0,0,1); }

.med-controls { display: flex; gap: 12px; width: 100%; margin-bottom: 20px; justify-content: center;}
.m-badge { padding: 10px 20px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 100px; font-family: 'Space Mono'; font-size: 0.55rem; color: #fff; text-align: center; backdrop-filter: blur(15px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

.back-btn { font-family: 'Space Mono'; font-size: 0.65rem; color: rgba(255,255,255,0.5); background: none; border: none; cursor: pointer; margin-bottom: 25px; text-transform: uppercase; transition: 0.3s; letter-spacing: 0.15em;}
.back-btn:hover { color: #fff; transform: translateX(-8px); }

/* Omni-Synth√®se Holographique */
.data-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 24px; margin-bottom: 18px; font-family: 'Outfit'; font-size: 1rem; line-height: 1.7; color: rgba(255,255,255,0.85); box-shadow: inset 0 0 30px rgba(0,0,0,0.6); }
.data-item { margin-bottom: 12px; }
.data-item strong { color: var(--gold); font-family: 'Cinzel'; font-size: 1.05rem; font-weight: 600; letter-spacing: 0.05em; }

.mini-tarot { display: flex; gap: 15px; justify-content: center; margin-bottom: 25px; perspective: 1000px; }
.m-card { padding: 18px 10px; border-radius: 16px; background: linear-gradient(135deg, rgba(20,0,50,0.8), rgba(40,0,80,0.9)); border: 1px solid var(--c1); border-top: 1px solid rgba(255,255,255,0.4); text-align: center; flex: 1; box-shadow: 0 20px 40px rgba(0,0,0,0.9); backdrop-filter: blur(15px); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
.m-card:hover { transform: translateY(-10px) rotateX(10deg) rotateY(-5deg); box-shadow: 0 30px 50px rgba(0,0,0,1), 0 0 20px var(--c1); border-color: var(--star);}
.m-card span { font-size: 2.8rem; display: block; margin-bottom: 10px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.5)); }
.m-card div { font-family: 'Cinzel'; font-size: 0.6rem; color: #fff; letter-spacing: 0.05em; font-weight: 600; }

.reading-box { font-family: 'Cormorant Garamond'; font-size: 1.35rem; font-style: italic; line-height: 1.9; color: #fff; padding: 35px; background: linear-gradient(135deg, rgba(229,177,92,0.15), rgba(0,0,0,0.8)); border: 1px solid rgba(229,177,92,0.5); border-radius: 24px; margin-top: 30px; text-align: center; box-shadow: 0 0 60px rgba(229,177,92,0.15), inset 0 0 20px rgba(229,177,92,0.05); }
</style>
</head>
<body>

<div class="aurora-container">
  <div class="aurora a1"></div><div class="aurora a2"></div>
  <div class="aurora a3"></div><div class="aurora a4"></div>
</div>
<canvas id="particleCanvas"></canvas>

<div id="setupOv">
  <div class="glass" style="width:100%; max-width:460px; text-align:center;">
    <div class="noise-overlay"></div>
    <h2 style="color:var(--gold); font-size:1.6rem; position:relative; z-index:2;">LA LOI DE R√âSONANCE</h2>
    <h3 style="color:rgba(255,255,255,0.7); text-transform:none; letter-spacing: 0.05em; margin-bottom: 30px; position:relative; z-index:2;">Initialisation de l'empreinte vibratoire.</h3>
    
    <div style="position:relative; z-index:2;">
      <input class="sb-inp" id="sbName" type="text" placeholder="Pr√©nom (Le Cr√©ateur)">
      <div style="font-family:'Space Mono'; font-size:0.55rem; color:var(--c4); margin-bottom:8px; text-align:left; padding-left:10px;">DATE DE NAISSANCE (Fr√©quence d'ancrage) :</div>
      <input class="sb-inp" id="sbDob" type="date" required>
      
      <div style="font-family:'Space Mono'; font-size:0.55rem; color:var(--gold); margin-bottom:8px; text-align:left; margin-top:15px; padding-left:10px;">L'INTENTION (Ligne de temps souhait√©e) :</div>
      <textarea class="sb-inp sb-area" id="sbIntent" placeholder="Ex: Je suis en parfaite sant√© et rempli d'√©nergie. / L'abondance coule vers moi sans effort."></textarea>
      
      <button class="btn btn-gold" onclick="saveSetup()" style="margin-top: 25px;">ACTIVER LE CHAMP UNIFI√â</button>
    </div>
  </div>
</div>

<div id="APP">
  <h1 id="mainTitle">OMNI-MATRICE</h1>
  
  <div class="panel show" id="panel-hub">
    
    <div class="intention-box" id="uiIntentionBox" style="display:none;">
      <h3>FR√âQUENCE CIBLE √âPIG√âN√âTIQUE</h3>
      <div class="intention-txt" id="uiIntentionTxt"></div>
    </div>

    <div class="glass" style="text-align:center; padding: 25px;">
      <div class="noise-overlay"></div>
      <h3 id="hubUserName" style="color: #fff; font-size: 0.75rem; position:relative; z-index:2;">VOTRE SIGNATURE</h3>
      <div style="font-family:'Space Mono'; font-size:0.6rem; color:var(--c4); margin-top:12px; letter-spacing: 0.15em; position:relative; z-index:2;" id="uiProfileData"></div>
    </div>
    
    <div class="ritual-grid">
      <div class="rc" onclick="openMeditation('aube')">
        <div class="noise-overlay"></div>
        <div class="rc-ico" style="color:#00f5d4;">üåÖ</div>
        <div class="rc-title">√âveil Neuro-Optique</div>
        <div class="rc-sub">Flux Optique ¬∑ B√™ta 15Hz ¬∑ Resp 6/2</div>
      </div>
      
      <div class="rc" onclick="openMeditation('soir')">
        <div class="noise-overlay"></div>
        <div class="rc-ico" style="color:#ff0054;">üåÜ</div>
        <div class="rc-title">Apaisement Vagal</div>
        <div class="rc-sub">2Hz Delta ¬∑ Resp 4-7-8</div>
      </div>

      <div class="rc rc-full" onclick="openMeditation('schumann')">
        <div class="noise-overlay"></div>
        <div class="rc-ico" style="color:#06d6a0;">üåç</div>
        <div class="rc-title">R√©sonance de Schumann</div>
        <div class="rc-sub">7.83Hz ¬∑ Ancrage Terrestre & Gu√©rison Cellulaire</div>
      </div>

      <div class="rc" onclick="openMeditation('quantum')">
        <div class="noise-overlay"></div>
        <div class="rc-ico" style="color:var(--gold);">üåÄ</div>
        <div class="rc-title" style="color:var(--gold);">Saut Quantique</div>
        <div class="rc-sub">8Hz Alpha ¬∑ Visualisation</div>
      </div>

      <div class="rc" onclick="openMeditation('pineal')">
        <div class="noise-overlay"></div>
        <div class="rc-ico" style="color:var(--star);">üëÅÔ∏è</div>
        <div class="rc-title">Glande Pin√©ale</div>
        <div class="rc-sub">936Hz + 33Hz Gamma</div>
      </div>
    </div>
  </div>

  <div class="panel" id="panel-omni">
    <button class="back-btn" onclick="switchTab('hub')">‚Üê Retour</button>
    <div class="glass">
      <div class="noise-overlay"></div>
      <h2 style="color:var(--gold); font-size: 1.4rem; position:relative; z-index:2;">L'ORACLE DE MANIFESTATION</h2>
      
      <div id="omniInitial" style="position:relative; z-index:2;">
        <p style="font-family:'Outfit'; font-size:1rem; text-align:center; margin-bottom:30px; color:rgba(255,255,255,0.8); line-height: 1.7;">
          L'intelligence de la Matrice va croiser votre Chemin de Vie, les √©ph√©m√©rides actuelles et les probabilit√©s quantiques du Tarot pour vous r√©v√©ler comment mat√©rialiser votre intention.
        </p>
        <button class="btn btn-gold" id="btnStartOmni" onclick="runOmniSynthesis()">‚ú¶ D√âCODER LE CHAMP QUANTIQUE ‚ú¶</button>
      </div>

      <div id="omniResult" style="display:none; position:relative; z-index:2;">
        <div class="data-box" id="omniAstroBox"></div>
        <div class="mini-tarot" id="omniTarotCards" style="margin-top: 30px;"></div>
        <div class="data-box" id="omniTarotBox"></div>
        <div class="reading-box" id="omniReadingTxt"></div>
        <button class="btn btn-gold" id="btnAudioOmni" onclick="playOmniAudio()" style="margin-top: 30px;">‚ñ∂ T√âL√âCHARGEMENT VOCAL DE L'ORACLE</button>
      </div>
    </div>
  </div>

  <div class="panel" id="panel-meditation">
    
    <div id="opticFlowContainer">
      <div class="optic-ring"></div><div class="optic-ring"></div>
      <div class="optic-ring"></div><div class="optic-ring"></div><div class="optic-ring"></div>
    </div>

    <button class="back-btn" onclick="closeMeditation()" style="position:relative; z-index:10;">‚Üê Retourner √† la mati√®re</button>
    
    <div class="glass" id="medGlass" style="min-height: 75vh; display:flex; flex-direction:column; justify-content: space-between;">
      <div class="noise-overlay"></div>
      
      <div style="position:relative; z-index:2;">
        <h2 id="medTitle" style="font-size: 1.5rem; letter-spacing:0.2em;">Neuro-Immersion</h2>
        <div class="med-controls">
          <div class="m-badge" id="ctrl-freq">Fr√©quence</div>
          <div class="m-badge" id="ctrl-breath">Respiration</div>
        </div>
      </div>
      
      <div class="med-container" id="medContainer">
        <div class="cymatic-core" id="bShape">
          <div class="med-text" id="bText">PR√äT</div>
          <div class="med-sub" id="bSub"></div>
        </div>
      </div>
      
      <button class="btn" id="btnPlayMed" onclick="toggleMeditation()" style="position:relative; z-index:2;">‚ñ∂ SYNCHRONISER LE CERVEAU</button>
    </div>
  </div>

</div>

<div class="tabs" id="navTabs">
  <button class="tab act" onclick="switchTab('hub')">Portails</button>
  <button class="tab" onclick="switchTab('omni')">L'Oracle</button>
</div>

<script>
/* ==========================================================================
   MOTEUR NEURO-ACOUSTIQUE AVANC√â (Anti-Click, Ramp, Stereo Panning)
   ========================================================================== */
class NeuroSynth {
  constructor() { this.ctx = null; this.isPlaying = false; }
  start(baseFreq, beatFreq) {
    if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    this.ctx.resume();
    this.master = this.ctx.createGain(); this.master.gain.setValueAtTime(0, this.ctx.currentTime); 
    this.master.gain.linearRampToValueAtTime(0.06, this.ctx.currentTime + 5); 
    this.master.connect(this.ctx.destination);
    
    this.oscL = this.ctx.createOscillator(); this.oscL.frequency.value = baseFreq;
    this.oscR = this.ctx.createOscillator(); this.oscR.frequency.value = baseFreq + beatFreq;
    
    let panL = this.ctx.createStereoPanner(); panL.pan.value = -1;
    let panR = this.ctx.createStereoPanner(); panR.pan.value = 1;
    
    this.oscL.connect(panL).connect(this.master); this.oscR.connect(panR).connect(this.master);
    this.oscL.start(); this.oscR.start(); this.isPlaying = true;
  }
  stop() {
    if(!this.isPlaying) return; 
    this.master.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 2);
    setTimeout(() => { if(this.oscL) this.oscL.stop(); if(this.oscR) this.oscR.stop(); this.isPlaying = false; }, 2000);
  }
}
const neuroAudio = new NeuroSynth();

/* ==========================================================================
   MOTEUR VOCAL ORGANIQUE (D√©coupage intelligent)
   ========================================================================== */
const OrganicVoice = {
  synth: window.speechSynthesis,
  speak(text, speed = 0.85, pitch = 0.9, cb = null) {
    this.synth.cancel(); 
    const chunks = text.match(/[^.!?]+[.!?]+/g) || [text];
    let index = 0;
    let v = this.synth.getVoices().find(x => x.lang.startsWith('fr') && (x.name.includes('Premium') || x.name.includes('Thomas'))) || this.synth.getVoices().find(x => x.lang.startsWith('fr'));
    
    const playNext = () => {
      if(index >= chunks.length) { if(cb) cb(); return; }
      let u = new SpeechSynthesisUtterance(chunks[index].trim());
      if(v) u.voice = v; u.rate = speed; u.pitch = pitch;
      u.onend = () => { index++; setTimeout(playNext, speed < 0.8 ? 1500 : 500); };
      this.synth.speak(u);
    };
    playNext();
  },
  stop() { this.synth.cancel(); }
};
if (window.speechSynthesis.onvoiceschanged !== undefined) window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

/* ==========================================================================
   LOGIQUE M√âTIER : NUM√âROLOGIE, ASTRO, TAROT
   ========================================================================== */
function getLifePath(dob) {
  let sum = dob.replace(/-/g, '').split('').map(Number).reduce((a, b) => a + b, 0);
  while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
  return sum;
}

const ZODIAC = ['B√©lier','Taureau','G√©meaux','Cancer','Lion','Vierge','Balance','Scorpion','Sagittaire','Capricorne','Verseau','Poissons'];
const ARCANA = [
  {n:'Le Mat',i:'üéí', k:'Le saut quantique inattendu.'}, {n:'Le Bateleur',i:'üÉè', k:'L\'intention dirig√©e devient mati√®re.'},
  {n:'La Papesse',i:'üé¥', k:'Incubation et confiance en l\'invisible.'}, {n:'L\'Imp√©ratrice',i:'üëë', k:'Manifestation par l\'abondance cr√©atrice.'},
  {n:'L\'Empereur',i:'üõ°Ô∏è', k:'Structuration de l\'√©nergie dans la 3D.'}, {n:'Le Pape',i:'üìú', k:'Sagesse spirituelle et reliance.'},
  {n:'L\'Amoureux',i:'üíû', k:'Alignement vibratoire du c≈ìur.'}, {n:'Le Chariot',i:'üèá', k:'Effondrement conscient de la probabilit√©.'},
  {n:'La Justice',i:'‚öñÔ∏è', k:'R√©√©quilibrage karmique.'}, {n:'L\'Ermite',i:'üèÆ', k:'L\'introspection augmente la fr√©quence.'},
  {n:'La Roue',i:'üé°', k:'Synchronicit√©s et cycles acc√©l√©r√©s.'}, {n:'La Force',i:'ü¶Å', k:'Ma√Ætrise de l\'esprit sur la biologie.'},
  {n:'Le Pendu',i:'ü™¢', k:'L√¢cher-prise indispensable au miracle.'}, {n:'L\'Arcane Sans Nom',i:'üíÄ', k:'Transmutation √©pig√©n√©tique.'},
  {n:'La Temp√©rance',i:'üåä', k:'Alchimie interne parfaite.'}, {n:'Le Diable',i:'‚õìÔ∏è', k:'Transmutation des croyances limitantes.'},
  {n:'La Maison Dieu',i:'‚ö°', k:'Choc lib√©rateur de l\'ancienne identit√©.'}, {n:'L\'√âtoile',i:'‚≠ê', k:'Guidance pure du champ unifi√©.'},
  {n:'La Lune',i:'üåô', k:'Reprogrammation du subconscient profond.'}, {n:'Le Soleil',i:'‚òÄÔ∏è', k:'L\'illumination et l\'√©vidence du succ√®s.'},
  {n:'Le Jugement',i:'üìØ', k:'L\'√©veil final de votre vraie nature.'}, {n:'Le Monde',i:'üåç', k:'L\'accomplissement holographique total.'}
];

let UP = JSON.parse(localStorage.getItem('qm-v10-prof'));

function updateProfileUI() {
  document.getElementById('uiProfileData').innerHTML = `CHEMIN DE VIE : ${UP.lifePath} &nbsp;¬∑&nbsp; ARCANE : ${UP.birthArcana.toUpperCase()}`;
  if(UP.intent) {
    document.getElementById('uiIntentionBox').style.display = 'block';
    document.getElementById('uiIntentionTxt').innerText = `"${UP.intent}"`;
  }
}

function saveSetup() {
  const n = document.getElementById('sbName').value.trim(); const dob = document.getElementById('sbDob').value; const intent = document.getElementById('sbIntent').value.trim();
  if(!dob) return alert("La date de naissance est requise."); if(!intent) return alert("Veuillez d√©finir votre intention.");
  const lp = getLifePath(dob);
  UP = { name: n || 'Cr√©ateur', dob: dob, intent: intent, lifePath: lp, birthArcana: ARCANA[lp % 22].n };
  localStorage.setItem('qm-v10-prof', JSON.stringify(UP));
  document.getElementById('setupOv').style.display = 'none'; updateProfileUI();
}
if(UP && UP.dob) { document.getElementById('setupOv').style.display = 'none'; updateProfileUI(); }

function getPlanets() {
  const d = (new Date() - new Date('2000-01-01T12:00:00Z')) / 86400000;
  return [{n:'Soleil', r:0.9856, l0:280.46}, {n:'Lune', r:13.1764, l0:218.32}].map(x => { return {...x, sign: ZODIAC[Math.floor((((x.l0 + x.r * d) % 360 + 360) % 360)/30)]}; });
}

function runOmniSynthesis() {
  document.getElementById('omniInitial').style.display = 'none';
  const p = getPlanets();
  
  document.getElementById('omniAstroBox').innerHTML = `
    <h3 style="text-align:left; color:var(--c4);">1. FONDATION √âPIG√âN√âTIQUE</h3>
    <div class="data-item"><strong>Fr√©quence Cible :</strong> Pour manifester <em>"${UP.intent}"</em>, votre biologie doit ressentir l'√©motion de l'√©v√©nement futur avant qu'il n'arrive.</div>
    <div class="data-item"><strong>Climat Stellaire :</strong> Le Soleil en ${p[0].sign} stimule votre syst√®me nerveux sympathique, la Lune en ${p[1].sign} ouvre votre subconscient √† la reprogrammation.</div>
  `;

  let deck = [...ARCANA].sort(()=>Math.random()-0.5).slice(0,3);
  document.getElementById('omniTarotCards').innerHTML = deck.map(c => `<div class="m-card"><span>${c.i}</span><div>${c.n}</div></div>`).join('');
  
  document.getElementById('omniTarotBox').innerHTML = `
    <h3 style="text-align:left; color:var(--gold);">2. D√âCODAGE AKASHIQUE</h3>
    <div class="data-item"><strong>L'Illusion √† dissoudre :</strong> ${deck[0].n} ‚Äî ${deck[0].k}</div>
    <div class="data-item"><strong>La Nouvelle Croyance :</strong> ${deck[1].n} ‚Äî ${deck[1].k}</div>
    <div class="data-item"><strong>La Mat√©rialisation :</strong> ${deck[2].n} ‚Äî ${deck[2].k}</div>
  `;

  const synthText = `LE CHAMP UNIFI√â VOUS R√âPOND : \n${UP.name}, votre intention r√©sonne d√©j√† dans la Matrice. Le secret n'est pas de forcer la r√©alit√©, mais de vous y aligner. La lumi√®re du jour favorise ce saut quantique. L'√©nergie de ${deck[1].n} est votre pont neuronal. L√¢chez l'ancien paradigme. Sentez une gratitude infinie d√®s maintenant, comme si c'√©tait d√©j√† fait. La manifestation est en cours.`;
  document.getElementById('omniReadingTxt').innerText = synthText;
  document.getElementById('omniResult').style.display = 'block';
}

function playOmniAudio() {
  const btn = document.getElementById('btnAudioOmni'); btn.innerText = "üîä TRANSMISSION EN COURS...";
  OrganicVoice.speak(document.getElementById('omniReadingTxt').innerText, 0.85, 0.95, () => { btn.innerText = "‚ñ∂ T√âL√âCHARGEMENT VOCAL DE L'ORACLE"; });
}

/* ==========================================================================
   NEURO-M√âDITATION CYMATIQUE ABSOLUE
   ========================================================================== */
let medState = { type: '', isPlaying: false, interval: null, step: 0 };

function openMeditation(type) {
  medState.type = type; document.getElementById('navTabs').classList.add('hidden');
  document.body.className = `mode-${type} mode-meditating`; 
  
  const title = document.getElementById('medTitle');
  const freq = document.getElementById('ctrl-freq');
  const breath = document.getElementById('ctrl-breath');
  const shape = document.getElementById('bShape');
  const text = document.getElementById('bText');
  const sub = document.getElementById('bSub');
  const opticFlow = document.getElementById('opticFlowContainer');
  
  shape.className = 'cymatic-core'; text.innerHTML = "PR√äT"; sub.innerHTML = "";
  shape.style.borderColor = 'rgba(255,255,255,0.3)'; shape.style.boxShadow = '0 0 50px rgba(255,255,255,0.1)';
  opticFlow.style.display = 'none';

  if(type === 'aube') {
    title.innerText = '√âveil Neuro-Optique'; freq.innerText = '432Hz + 15Hz B√™ta'; breath.innerText = '6s IN / 2s OUT';
    shape.style.background = 'radial-gradient(circle at 30% 30%, rgba(0,245,212,0.4), transparent)';
    opticFlow.style.display = 'flex'; // Activation de la stimulation visuelle
  } else if(type === 'soir') {
    title.innerText = 'Apaisement Vagal (4-7-8)'; freq.innerText = '528Hz + 2Hz Delta'; breath.innerText = '4s IN / 7s HOLD / 8s OUT';
    shape.style.background = 'radial-gradient(circle at 30% 30%, rgba(208,0,0,0.5), transparent)';
  } else if(type === 'schumann') {
    title.innerText = 'Ancrage Terrestre'; freq.innerText = '432Hz + 7.83Hz'; breath.innerText = 'Coh√©rence 5s / 5s';
    shape.style.background = 'radial-gradient(circle at 30% 30%, rgba(64,145,108,0.5), transparent)';
  } else if(type === 'quantum') {
    title.innerText = 'Saut Quantique'; freq.innerText = '528Hz + 8Hz Alpha'; breath.innerText = 'Visualisation';
    shape.style.background = 'radial-gradient(circle at 30% 30%, rgba(229,177,92,0.5), transparent)';
  } else if(type === 'pineal') {
    title.innerText = 'Glande Pin√©ale'; freq.innerText = '936Hz + 33Hz Gamma'; breath.innerText = 'Compression';
    shape.style.background = 'radial-gradient(circle at 30% 30%, rgba(157,78,221,0.5), transparent)';
  }
  switchTab('meditation');
}

function setShape(state, mainTxt, subTxt) {
  const shape = document.getElementById('bShape');
  shape.className = `cymatic-core ${state}`;
  document.getElementById('bText').innerHTML = mainTxt;
  document.getElementById('bSub').innerHTML = subTxt;
}

function toggleMeditation() {
  const btn = document.getElementById('btnPlayMed');

  if(medState.isPlaying) {
    medState.isPlaying = false; clearInterval(medState.interval); neuroAudio.stop(); OrganicVoice.stop();
    btn.innerText = "‚ñ∂ SYNCHRONISER LE CERVEAU"; setShape('', 'PR√äT', ''); document.body.classList.remove('mode-meditating'); return;
  }

  medState.isPlaying = true; medState.step = 0; btn.innerText = "‚èπ D√âSACTIVER LE CHAMP";
  
  if(medState.type === 'aube') {
    // STIMULATION NEURO-OPTIQUE : Ondes B√™ta + Flux Optique + Respiration Activatrice
    neuroAudio.start(432, 15); 
    OrganicVoice.speak("Fixez le centre. Le flux optique simule le mouvement vers l'avant et lib√®re la dopamine. Inspirez puissamment l'√©nergie... et rel√¢chez.", 0.85, 1.0);
    const cycle = () => {
      if(!medState.isPlaying) return;
      if(medState.step % 2 === 0) { setShape('inhale', 'INSPIRER', '6 SECONDES'); document.getElementById('bShape').style.transition = "all 6s ease-out"; } 
      else { setShape('exhale', 'EXPIRER', '2 SECONDES'); document.getElementById('bShape').style.transition = "all 2s ease-in"; }
      medState.step++; medState.interval = setTimeout(cycle, (medState.step % 2 !== 0) ? 6000 : 2000);
    }; cycle();
  } 
  else if(medState.type === 'soir') {
    // 4-7-8 Breathing (Nerf Vague)
    neuroAudio.start(528, 2); OrganicVoice.speak("La m√©thode 4 7 8 active le nerf vague parasympathique. D√©tendez-vous totalement.", 0.75, 0.8);
    const cycle = () => {
      if(!medState.isPlaying) return;
      let s = medState.step % 3;
      if(s === 0) { setShape('inhale', 'INSPIRER', '4 SECONDES'); document.getElementById('bShape').style.transition = "all 4s linear"; }
      else if(s === 1) { setShape('hold', 'RETENIR', '7 SECONDES'); document.getElementById('bShape').style.transition = "all 0.5s"; }
      else if(s === 2) { setShape('exhale', 'EXPIRER', '8 SECONDES'); document.getElementById('bShape').style.transition = "all 8s linear"; }
      medState.step++; 
      let delay = s === 0 ? 4000 : (s === 1 ? 7000 : 8000);
      medState.interval = setTimeout(cycle, delay);
    }; cycle();
  } 
  else if(medState.type === 'schumann') {
    neuroAudio.start(432, 7.83); OrganicVoice.speak("La fr√©quence de Schumann reconnecte votre biologie √† la Terre. Coh√©rence cardiaque.", 0.8, 0.9);
    const cycle = () => {
      if(!medState.isPlaying) return;
      if(medState.step % 2 === 0) { setShape('inhale', 'INSPIRER', '5 SECONDES'); document.getElementById('bShape').style.transition = "all 5s linear"; } 
      else { setShape('exhale', 'EXPIRER', '5 SECONDES'); document.getElementById('bShape').style.transition = "all 5s linear"; }
      medState.step++; medState.interval = setTimeout(cycle, 5000);
    }; cycle();
  }
  else if(medState.type === 'quantum') {
    neuroAudio.start(528, 8); setShape('hold', 'SAUT<br>QUANTIQUE', UP.intent.substring(0, 20) + '...');
    const script = `L'onde Alpha ouvre le subconscient. L'univers ne fait pas la diff√©rence entre l'imagination et la r√©alit√©. Sentez l'√©motion de cette intention : ${UP.intent}. Soyez reconnaissant maintenant. Vous avez chang√© de ligne de temps.`;
    OrganicVoice.speak(script, 0.75, 0.85); 
  } 
  else if(medState.type === 'pineal') {
    neuroAudio.start(936, 33); setShape('hold', 'TROISI√àME<br>≈íIL', 'ACTIVATION 936Hz');
    const script = "La fr√©quence 936 Hertz r√©sonne. Inspirez profond√©ment. Contractez le p√©rin√©e. Poussez le liquide rachidien vers le cerveau. Retenez l'air... Appuyez sur la glande pin√©ale. Vous √™tes l'univers observant lui-m√™me.";
    OrganicVoice.speak(script, 0.75, 0.8); 
  }
}

function closeMeditation() { 
  if(medState.isPlaying) toggleMeditation(); 
  document.body.className = ''; document.body.classList.remove('mode-meditating');
  document.getElementById('navTabs').classList.remove('hidden'); switchTab('hub'); 
}

function switchTab(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('act'));
  if(event && event.target && event.target.classList) event.target.classList.add('act');
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('show'));
  document.getElementById('panel-' + id).classList.add('show');
  OrganicVoice.stop(); neuroAudio.stop();
}
</script>
</body>
</html>